plugin.Tx_Formhandler.settings.predef {

	formhandler_subscription_request_subscription {

		addErrorAnchors = 0
		debug = 1

		additionalIncludePaths {
			1 = EXT:formhandler_subscription/Classes/Finisher
			2 = EXT:formhandler_subscription/Classes/PreProcessor
		}

		isErrorMarker {
			default = error
			global (
				<div class="error">
					<strong>Fehler</strong><br />
					Es wurden nicht alle erforderlichen Felder ausgefüllt oder
					eine Ihrer Eingaben war fehlerhaft.<br />
					Bitte prüfen Sie Ihre Angaben.
				</div><br />
			)
		}

	}

	formhandler_subscription_confirm_subscription < .formhandler_subscription_request_subscription
	formhandler_subscription_request_modification < .formhandler_subscription_request_subscription
	formhandler_subscription_modify_subscription < .formhandler_subscription_request_subscription

	formhandler_subscription_request_subscription {

		name = Subscribe
		formValuesPrefix = tx_formhandler_requestsubscription

		templateFile = EXT:formhandler_subscription/Resources/Templates/RequestSubscription.html
		langFile.1 = EXT:formhandler_subscription/Resources/Language/RequestSubscription.xml

		validators {
			1.class = Tx_Formhandler_Validator_Default
			1.config.fieldConf {
				gender.errorCheck.1 = required
				first_name.errorCheck.1 = required
				last_name.errorCheck.1 = required
				email.errorCheck.1 = required
				email.errorCheck.2 = email
			}
		}

		finishers {

			1.class = Tx_FormhandlerSubscription_Finisher_Subscribe
			1.config {

				subscribersTable = {$plugin.formhandler_subscription.subscribersTable}

				setTemplateSuffix = 1

				checkConfirmedSelect.pidInList = {$plugin.formhandler_subscription.subscriberRecordsPID}
				checkConfirmedSelect.markers.email.data = GP:tx_formhandler_requestsubscription|email
				checkConfirmedSelect.where = email=###email###

				checkExistenceSelect < .checkConfirmedSelect
				checkExistenceSelect.showHidden = 1

				finishersNewSubscriber {

					10.class = Tx_Formhandler_Finisher_AutoDB
					10.config {
						table = {$plugin.formhandler_subscription.subscribersTable}

						10.fields {
							hidden = 1
							pid = {$plugin.formhandler_subscription.newSubscriberRecordsPID}
						}
					}

					20.class = Tx_FormhandlerSubscription_Finisher_GenerateAuthCodeDB
					20.config {
						table = {$plugin.formhandler_subscription.subscribersTable}
						selectFields = uid,email
						authCodePage = {$plugin.formhandler_subscription.confirmSubscriptionPID}
					}

					30.class = Tx_Formhandler_Finisher_Mail
					30.config.mailer.class = Tx_FormhandlerSubscription_Mailer_TYPO3Mailer
					30.config.view = Tx_FormhandlerSubscription_View_AuthCodeMail
					30.config.user {
						subject = Ihre Newsletter Anmeldung
						sender_email = no-reply@swebhosting.de
						sender_name = Newsletter
						to_name = TEXT
						to_name.value = {GP:tx_formhandler_requestsubscription|first_name} {GP:tx_formhandler_requestsubscription|last_name}
						to_name.insertData = 1
						to_email = TEXT
						to_email.value = {GP:tx_formhandler_requestsubscription|email}
						to_email.insertData = 1
					}
				}

				finishersExistingUnconfirmedSubscriber < .finishersNewSubscriber
				finishersExistingUnconfirmedSubscriber.10 >

				finishersExistingConfirmedSubscriber {


				}
			}

			#10.class = Tx_Formhandler_Finisher_Redirect
			#10.config.redirectPage = {$plugin.formhandler_subscription.subscribeSuccessPID}

		}
	}


	formhandler_subscription_confirm_subscription {

		name = Subscribe Confirmation

		templateFile = EXT:formhandler_subscription/Resources/Templates/RequestSubscription.html
		templateSuffix = _SUBSCRIPTION_CONFIRMED
		formValuesPrefix = tx_formhandler_requestsubscription

		preProcessors.10.class = Tx_FormhandlerSucription_PreProcessor_ValidateAuthCodeDB
		preProcessors.10.config {
			errorRedirectPage = {$plugin.formhandler_subscription.authCodeInvalidPID}
			authCodeRequired = 1
		}
	}


	formhandler_subscription_request_modification {

		name = Subscription Modification Request

		templateFile = EXT:formhandler_subscription/Resources/Templates/RequestModification.html
		langFile.1 = EXT:formhandler_subscription/Resources/Language/RequestModification.xml

		validators {
			1.class = Tx_Formhandler_Validator_Default
			1.config.fieldConf {
				email.errorCheck.1 = required
				email.errorCheck.2 = email
			}
		}

		finishers {

			1 < plugin.Tx_Formhandler.settings.predef.formhandler_subscription_request_subscription.finishers.1

			2 {
				class = Tx_Formhandler_Finisher_SubmittedOK
				config.returns = 1
			}
		}
	}


	formhandler_subscription_modify_subscription {

		name = Subscription Modification Form

		templateFile = EXT:formhandler_subscription/Resources/Templates/ModifySubscription.html
	}

}